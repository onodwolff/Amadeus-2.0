# Пошаговый бэклог по внедрению NautilusTrader

Этот документ декомпозирует этапы из [плана интеграции](./nautilus_integration_plan.md) в конкретные задачи, которые можно брать в работу последовательно. Каждая задача включает описание результата, критерии готовности и связи с другими пунктами.

## Этап 1. Поднятие базового узла NautilusTrader через gateway

### 1.1 Управление конфигурациями
- **Результат:** `NautilusEngineService` умеет принимать конфигурации узлов NautilusTrader через REST API и сохранять их в `.gateway/nodes`.
- **Критерии готовности:**
  - Схема конфигурации валидируется, ошибки возвращаются в API.
  - Файлы конфигураций логично структурированы (по идентификатору узла и типу режима).
  - Покрывающие unit-тесты на валидацию.
- **Предпосылки:** нет.

### 1.2 Запуск узлов в backtest режиме
- **Результат:** API `/nodes/launch` разворачивает `TradingNode` в backtest режиме с перенаправлением событий в `EngineEventBus`.
- **Критерии готовности:**
  - Узел поднимается с тестовыми историческими данными.
  - Состояния узла видны в WebSocket потоке.
  - Есть команда/скрипт для локального запуска.
- **Предпосылки:** завершена задача 1.1.

### 1.3 Запуск узлов в live режиме
- **Результат:** Возможность запускать live узлы с реальными адаптерами (пока mock-подключение).
- **Критерии готовности:**
  - Узел инициализируется с live конфигурацией.
  - События статуса передаются в UI так же, как от mock-сервиса.
  - Логи узла доступны через gateway.
- **Предпосылки:** задачи 1.1 и 1.2.

### 1.4 Телеметрия и метрики
- **Результат:** Реальные метрики NautilusTrader транслируются в систему мониторинга gateway.
- **Критерии готовности:**
  - PnL, задержки и ресурсы видны в UI/логах.
  - Предусмотрены алерты при отклонении.
  - Mock-метрики отключены.
- **Предпосылки:** задачи 1.2–1.3.

## Этап 2. Реальные данные и торговые операции

### 2.1 Подключение биржевых адаптеров
- **Результат:** UI/API позволяет выбирать адаптеры (Binance, Bybit, IB) и хранить ключи.
- **Критерии готовности:**
  - Доступны CRUD-операции для адаптеров.
  - Проверка статуса подключения.
  - Интеграционные тесты с sandbox или mock.
- **Предпосылки:** завершён Этап 1.

### 2.2 Загрузка исторических данных
- **Результат:** Реализована загрузка исторических котировок через data-provider адаптеры.
- **Критерии готовности:**
  - API/CLI для запроса данных.
  - Кэширование датасетов на файловом или объектном хранилище.
  - Документация по процессу.
- **Предпосылки:** задачи 1.1–1.2.

### 2.3 Поддержка продвинутых типов ордеров
- **Результат:** `/orders` и UI обрабатывают все типы ордеров NautilusTrader.
- **Критерии готовности:**
  - Валидация параметров ордеров.
  - Отображение состояния в UI.
  - Автотесты на конвертацию и маппинг.
- **Предпосылки:** задачи 2.1 и 1.3.

## Этап 3. Риск-менеджмент и координация

### 3.1 Реальные риск-алерты
- **Результат:** Риск-модули NautilusTrader генерируют события, потребляемые gateway.
- **Критерии готовности:**
  - Подключены модули риск-менеджмента.
  - Настройки порогов управляются через API.
  - Алерты видны в UI и логируются.
- **Предпосылки:** завершены задачи Этапа 2.

### 3.2 Кластер из нескольких узлов
- **Результат:** Gateway управляет несколькими узлами и маршрутизирует ордера.
- **Критерии готовности:**
  - Реализованы CRUD операций по узлам.
  - Сводный мониторинг по всем стратегиям.
  - Тестовые сценарии на отказоустойчивость.
- **Предпосылки:** задачи 1.3 и 3.1.

### 3.3 Персистентность состояний
- **Результат:** Состояния позиций/ордеров сохраняются между перезапусками.
- **Критерии готовности:**
  - Интеграция с Redis или другим state backend.
  - Механизм миграций данных.
  - Документация по восстановлению.
- **Предпосылки:** задачи 3.1 и 3.2.

## Этап 4. Автоматизация и AI-интеграция

### 4.1 Автоматическое тестирование стратегий
- **Результат:** Настроен пайплайн батчевых backtest-ов.
- **Критерии готовности:**
  - Конфигурации запускаются параллельно.
  - Результаты агрегируются и публикуются.
  - CI-проверка на минимальный набор сценариев.
- **Предпосылки:** задачи 1.2 и 2.2.

### 4.2 Интеграция с AI-агентами
- **Результат:** Внешние ML/AI агенты могут запускать backtest и деплоить стратегии.
- **Критерии готовности:**
  - Документированное SDK/API.
  - Авторизация и аудит действий агентов.
  - Примеры интеграций.
- **Предпосылки:** задачи 4.1 и 2.3.

### 4.3 Непрерывный контроль качества
- **Результат:** Автоматические проверки конфигураций перед деплоем.
- **Критерии готовности:**
  - Linting/validation pipeline.
  - Smoke-тесты узлов перед запуском.
  - Отчётность по проверкам в CI/CD.
- **Предпосылки:** завершены ключевые задачи этапов 1–3.
