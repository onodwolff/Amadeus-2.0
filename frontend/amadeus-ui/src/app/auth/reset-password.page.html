<div class="auth-page">
  <ng-container *ngIf="token(); else missingToken">
    <form class="auth-form" (ngSubmit)="submit()" *ngIf="!completed(); else success">
      <h1 class="auth-form__title">Set a new password</h1>
      <p class="auth-form__description">
        Choose a strong password to secure your account. The link you used will expire after a single use.
      </p>

      <div class="auth-form__alert" *ngIf="error()">{{ error() }}</div>
      <div class="auth-form__alert auth-form__alert--warning" *ngIf="mismatch()">
        The passwords do not match. Please try again.
      </div>

      <div class="auth-form__field">
        <label for="newPassword">New password</label>
        <input
          id="newPassword"
          type="password"
          formControlName="newPassword"
          autocomplete="new-password"
          [class.auth-form__input--invalid]="form.controls.newPassword.invalid && form.controls.newPassword.touched"
        />
        <p class="auth-form__hint" *ngIf="form.controls.newPassword.invalid && form.controls.newPassword.touched">
          Passwords must be at least 8 characters long.
        </p>
      </div>

      <div class="auth-form__field">
        <label for="confirmPassword">Confirm password</label>
        <input
          id="confirmPassword"
          type="password"
          formControlName="confirmPassword"
          autocomplete="new-password"
          [class.auth-form__input--invalid]="form.controls.confirmPassword.invalid && form.controls.confirmPassword.touched"
        />
        <p class="auth-form__hint" *ngIf="form.controls.confirmPassword.invalid && form.controls.confirmPassword.touched">
          Please confirm your new password.
        </p>
      </div>

      <button type="submit" class="auth-form__submit" [disabled]="isSubmitting()">
        <span *ngIf="!isSubmitting(); else loading">Update password</span>
      </button>
      <ng-template #loading><span>Updatingâ€¦</span></ng-template>

      <a routerLink="/login" class="auth-form__link">Return to sign in</a>
    </form>

    <ng-template #success>
      <div class="auth-form auth-form--success">
        <h1 class="auth-form__title">Password updated</h1>
        <p class="auth-form__description">
          Your password has been updated successfully. You can now sign in with your new credentials.
        </p>
        <a routerLink="/login" class="auth-form__link">Back to sign in</a>
      </div>
    </ng-template>
  </ng-container>

  <ng-template #missingToken>
    <div class="auth-form auth-form--error">
      <h1 class="auth-form__title">Invalid reset link</h1>
      <p class="auth-form__description">
        {{ error() ?? 'We could not find a valid reset token. Please request a new password reset email.' }}
      </p>
      <a routerLink="/forgot-password" class="auth-form__link">Request another link</a>
    </div>
  </ng-template>
</div>
