<section class="nodes-page">
  <header class="nodes-page__header">
    <div>
      <h1 class="nodes-page__title">Nodes</h1>
      <p class="nodes-page__subtitle">
        Manage Nautilus Trader sessions. Launch new backtests or live trading nodes and monitor their status in real time.
      </p>
    </div>
    <div class="nodes-page__actions">
      <button type="button" class="btn btn--primary" (click)="startBacktest()">Start backtest</button>
      <button type="button" class="btn btn--primary" (click)="startLive()">Start live</button>
      <button type="button" class="btn" (click)="refresh()">Refresh</button>
    </div>
  </header>

  <div class="nodes-page__meta">
    <div class="meta-card">
      <span class="meta-card__label">WebSocket</span>
      <span class="meta-card__value" [class.meta-card__value--warn]="wsState() !== 'connected'">{{ wsState() }}</span>
    </div>
    <div class="meta-card" *ngIf="healthInfo() as health">
      <span class="meta-card__label">Gateway health</span>
      <span class="meta-card__value">{{ health.status || (health | json) }}</span>
    </div>
    <div class="meta-card" *ngIf="coreInfo() as core">
      <span class="meta-card__label">Nautilus core</span>
      <span class="meta-card__value">{{ core.available ? 'online' : 'offline' }}</span>
      <span class="meta-card__hint" *ngIf="core.nautilus_version">v{{ core.nautilus_version }}</span>
    </div>
  </div>

  <p class="nodes-page__error" *ngIf="errorText() as error">{{ error }}</p>

  <div class="nodes-table" *ngIf="hasNodes(); else emptyState">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Mode</th>
          <th>Status</th>
          <th>Detail</th>
          <th>PnL</th>
          <th>Latency</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let node of nodes()">
          <td data-label="ID"><code>{{ node.id }}</code></td>
          <td data-label="Mode"><span class="tag">{{ node.mode }}</span></td>
          <td data-label="Status">
            <span class="status" [class.status--running]="node.status === 'running'" [class.status--stopped]="node.status !== 'running'">{{ node.status }}</span>
          </td>
          <td data-label="Detail" class="detail">{{ node.detail || '—' }}</td>
          <td data-label="PnL">{{ node.metrics?.pnl ?? '—' }}</td>
          <td data-label="Latency">{{ node.metrics?.latency_ms ? node.metrics?.latency_ms + ' ms' : '—' }}</td>
          <td data-label="Actions" class="actions">
            <button type="button" class="btn btn--ghost" (click)="stop(node)" [disabled]="node.status !== 'running'">Stop</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #emptyState>
    <div class="empty-state">
      <h2>No nodes yet</h2>
      <p>Launch a new backtest or live session to see it appear here.</p>
    </div>
  </ng-template>
</section>
